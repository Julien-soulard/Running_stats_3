<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Running Stats - Progression</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

        const RunningViz = () => {
            const [view, setView] = useState('distance');
            const [showKm, setShowKm] = useState(true);
            const [showMin, setShowMin] = useState(true);
            const [showPace, setShowPace] = useState(true);
            const [data, setData] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                Papa.parse('data.csv', {
                    download: true,
                    header: true,
                    dynamicTyping: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        const processedData = results.data.map(row => {
                            const pace = row.duree_min / row.distance_km;
                            const dateObj = new Date(row.date);
                            const formattedDate = `${String(dateObj.getDate()).padStart(2, '0')}/${String(dateObj.getMonth() + 1).padStart(2, '0')}`;
                            
                            return {
                                seance: row.seance,
                                date: formattedDate,
                                duree: row.duree_min,
                                distance: row.distance_km,
                                semaine: row.semaine,
                                pace: pace
                            };
                        });
                        setData(processedData);
                        setLoading(false);
                    },
                    error: (error) => {
                        console.error('Error loading CSV:', error);
                        setLoading(false);
                    }
                });
            }, []);

            if (loading) {
                return (
                    <div className="w-full h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-50">
                        <div className="text-2xl text-gray-600">Chargement des donn√©es...</div>
                    </div>
                );
            }

            const calculatedWeeklyStats = [];
            const maxWeek = Math.max(...data.map(d => d.semaine));
            
            for (let week = 1; week <= maxWeek; week++) {
                const weekData = data.filter(d => d.semaine === week);
                if (weekData.length > 0) {
                    const totalKm = weekData.reduce((sum, d) => sum + d.distance, 0);
                    const totalMin = weekData.reduce((sum, d) => sum + d.duree, 0);
                    const avgPace = totalMin / totalKm;
                    calculatedWeeklyStats.push({
                        semaine: `S${week}`,
                        totalKm: parseFloat(totalKm.toFixed(2)),
                        totalMin: Math.round(totalMin),
                        avgPace: parseFloat(avgPace.toFixed(2))
                    });
                }
            }

            const totalDistance = data.reduce((sum, d) => sum + d.distance, 0);
            const totalDuration = data.reduce((sum, d) => sum + d.duree, 0);
            const avgPace = totalDuration / totalDistance;

            return (
                <div className="w-full min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-6">
                    <div className="max-w-7xl mx-auto">
                        <h1 className="text-3xl font-bold text-gray-800 mb-2 flex items-center gap-3">
                            üèÉ Progression Running
                        </h1>
                        <p className="text-gray-600 mb-6">Analyse de vos s√©ances</p>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div className="bg-white rounded-lg shadow-md p-5">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm">Distance totale</p>
                                        <p className="text-3xl font-bold text-indigo-600">{totalDistance.toFixed(1)} km</p>
                                    </div>
                                    <span className="text-4xl">üìà</span>
                                </div>
                            </div>
                            
                            <div className="bg-white rounded-lg shadow-md p-5">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm">Temps total</p>
                                        <p className="text-3xl font-bold text-green-600">{Math.floor(totalDuration / 60)}h {Math.floor(totalDuration % 60)}min</p>
                                    </div>
                                    <span className="text-4xl">‚è±Ô∏è</span>
                                </div>
                            </div>
                            
                            <div className="bg-white rounded-lg shadow-md p-5">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm">Allure moyenne</p>
                                        <p className="text-3xl font-bold text-purple-600">{Math.floor(avgPace)}:{Math.floor((avgPace % 1) * 60).toString().padStart(2, '0')}/km</p>
                                    </div>
                                    <span className="text-4xl">‚ö°</span>
                                </div>
                            </div>
                        </div>

                        <div className="flex gap-2 mb-6 flex-wrap">
                            <button
                                onClick={() => setView('distance')}
                                className={`px-4 py-2 rounded-lg font-medium transition ${
                                    view === 'distance' 
                                        ? 'bg-indigo-600 text-white shadow-md' 
                                        : 'bg-white text-gray-700 hover:bg-gray-100'
                                }`}
                            >
                                Distance par s√©ance
                            </button>
                            <button
                                onClick={() => setView('duree')}
                                className={`px-4 py-2 rounded-lg font-medium transition ${
                                    view === 'duree' 
                                        ? 'bg-indigo-600 text-white shadow-md' 
                                        : 'bg-white text-gray-700 hover:bg-gray-100'
                                }`}
                            >
                                Dur√©e par s√©ance
                            </button>
                            <button
                                onClick={() => setView('pace')}
                                className={`px-4 py-2 rounded-lg font-medium transition ${
                                    view === 'pace' 
                                        ? 'bg-indigo-600 text-white shadow-md' 
                                        : 'bg-white text-gray-700 hover:bg-gray-100'
                                }`}
                            >
                                Allure par s√©ance
                            </button>
                            <button
                                onClick={() => setView('weekly')}
                                className={`px-4 py-2 rounded-lg font-medium transition ${
                                    view === 'weekly' 
                                        ? 'bg-indigo-600 text-white shadow-md' 
                                        : 'bg-white text-gray-700 hover:bg-gray-100'
                                }`}
                            >
                                Statistiques hebdomadaires
                            </button>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6">
                            {view === 'distance' && (
                                <>
                                    <h2 className="text-xl font-semibold text-gray-800 mb-4">Distance par s√©ance</h2>
                                    <ResponsiveContainer width="100%" height={400}>
                                        <LineChart data={data}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                                            <XAxis dataKey="seance" stroke="#666" />
                                            <YAxis stroke="#666" label={{ value: 'Distance (km)', angle: -90, position: 'insideLeft' }} />
                                            <Tooltip 
                                                contentStyle={{ backgroundColor: '#fff', border: '1px solid #ddd', borderRadius: '8px' }}
                                                formatter={(value) => [`${value} km`, 'Distance']}
                                            />
                                            <Legend />
                                            <Line 
                                                type="monotone" 
                                                dataKey="distance" 
                                                stroke="#4f46e5" 
                                                strokeWidth={3}
                                                dot={{ fill: '#4f46e5', r: 5 }}
                                                activeDot={{ r: 7 }}
                                                name="Distance (km)"
                                            />
                                        </LineChart>
                                    </ResponsiveContainer>
                                </>
                            )}

                            {view === 'duree' && (
                                <>
                                    <h2 className="text-xl font-semibold text-gray-800 mb-4">Dur√©e par s√©ance</h2>
                                    <ResponsiveContainer width="100%" height={400}>
                                        <BarChart data={data}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                                            <XAxis dataKey="seance" stroke="#666" />
                                            <YAxis stroke="#666" label={{ value: 'Dur√©e (min)', angle: -90, position: 'insideLeft' }} />
                                            <Tooltip 
                                                contentStyle={{ backgroundColor: '#fff', border: '1px solid #ddd', borderRadius: '8px' }}
                                                formatter={(value) => [`${value.toFixed(1)} min`, 'Dur√©e']}
                                            />
                                            <Legend />
                                            <Bar dataKey="duree" fill="#10b981" name="Dur√©e (min)" radius={[8, 8, 0, 0]} />
                                        </BarChart>
                                    </ResponsiveContainer>
                                </>
                            )}

                            {view === 'pace' && (
                                <>
                                    <h2 className="text-xl font-semibold text-gray-800 mb-4">Allure par s√©ance</h2>
                                    <ResponsiveContainer width="100%" height={400}>
                                        <LineChart data={data}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                                            <XAxis dataKey="seance" stroke="#666" />
                                            <YAxis 
                                                stroke="#666" 
                                                label={{ value: 'Allure (min/km)', angle: -90, position: 'insideLeft' }}
                                                domain={[7, 11]}
                                                ticks={[7, 8, 9, 10, 11]}
                                            />
                                            <Tooltip 
                                                contentStyle={{ backgroundColor: '#fff', border: '1px solid #ddd', borderRadius: '8px' }}
                                                formatter={(value) => {
                                                    const mins = Math.floor(value);
                                                    const secs = Math.floor((value - mins) * 60);
                                                    return [`${mins}:${secs.toString().padStart(2, '0')}/km`, 'Allure'];
                                                }}
                                            />
                                            <Legend />
                                            <Line 
                                                type="monotone" 
                                                dataKey="pace" 
                                                stroke="#a855f7" 
                                                strokeWidth={3}
                                                dot={{ fill: '#a855f7', r: 5 }}
                                                activeDot={{ r: 7 }}
                                                name="Allure (min/km)"
                                            />
                                        </LineChart>
                                    </ResponsiveContainer>
                                    <p className="text-sm text-gray-600 mt-2 text-center">
                                        ‚¨áÔ∏è Plus la courbe descend, plus vous courez vite
                                    </p>
                                </>
                            )}

                            {view === 'weekly' && (
                                <>
                                    <h2 className="text-xl font-semibold text-gray-800 mb-4">Statistiques hebdomadaires</h2>
                                    <div className="flex gap-3 mb-4 flex-wrap">
                                        <label className="flex items-center gap-2 cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={showKm}
                                                onChange={(e) => setShowKm(e.target.checked)}
                                                className="w-4 h-4 text-indigo-600 rounded"
                                            />
                                            <span className="text-sm font-medium text-gray-700">Distance (km)</span>
                                        </label>
                                        <label className="flex items-center gap-2 cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={showMin}
                                                onChange={(e) => setShowMin(e.target.checked)}
                                                className="w-4 h-4 text-amber-600 rounded"
                                            />
                                            <span className="text-sm font-medium text-gray-700">Temps (min)</span>
                                        </label>
                                        <label className="flex items-center gap-2 cursor-pointer">
                                            <input
                                                type="checkbox"
                                                checked={showPace}
                                                onChange={(e) => setShowPace(e.target.checked)}
                                                className="w-4 h-4 text-purple-600 rounded"
                                            />
                                            <span className="text-sm font-medium text-gray-700">Allure (min/km)</span>
                                        </label>
                                    </div>
                                    <ResponsiveContainer width="100%" height={400}>
                                        <BarChart data={calculatedWeeklyStats}>
                                            <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                                            <XAxis dataKey="semaine" stroke="#666" />
                                            <YAxis stroke="#666" />
                                            <Tooltip 
                                                contentStyle={{ backgroundColor: '#fff', border: '1px solid #ddd', borderRadius: '8px' }}
                                                formatter={(value, name) => {
                                                    if (name === 'Allure moyenne (min/km)') {
                                                        const mins = Math.floor(value);
                                                        const secs = Math.floor((value - mins) * 60);
                                                        return [`${mins}:${secs.toString().padStart(2, '0')}/km`, name];
                                                    }
                                                    return [value.toFixed(2), name];
                                                }}
                                            />
                                            <Legend />
                                            {showKm && <Bar dataKey="totalKm" fill="#4f46e5" name="Distance totale (km)" radius={[8, 8, 0, 0]} />}
                                            {showMin && <Bar dataKey="totalMin" fill="#f59e0b" name="Temps total (min)" radius={[8, 8, 0, 0]} />}
                                            {showPace && <Bar dataKey="avgPace" fill="#a855f7" name="Allure moyenne (min/km)" radius={[8, 8, 0, 0]} />}
                                        </BarChart>
                                    </ResponsiveContainer>
                                </>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<RunningViz />, document.getElementById('root'));
    </script>
</body>
</html>